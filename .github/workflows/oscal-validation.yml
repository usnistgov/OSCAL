name: OSCAL Validation

on:
  push:
    branches: [ main, add-171a-plan ]

jobs:
  validate-oscal:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4
      with:
        submodules: false
    
    - name: Setup Java
      uses: actions/setup-java@v4
      with:
        distribution: temurin
        java-version: '17'
    
    - name: Setup OSCAL CLI
      uses: oscal-club/oscal-cli-action@v2.0.1
      with:
        args: --version
    
    - name: Validate Catalogs
      run: |
        for file in $(find . -name "*catalog*.json" 2>/dev/null); do
          if [ -f "$file" ]; then
            echo "Validating: $file"
            oscal-cli catalog validate "$file"
          fi
        done
      continue-on-error: true
    
    - name: Validate Profiles
      run: |
        for file in $(find . -name "*profile*.json" 2>/dev/null); do
          if [ -f "$file" ]; then
            echo "Validating: $file"
            oscal-cli profile validate "$file"
          fi
        done
      continue-on-error: true
    
    - name: Validate SSPs
      run: |
        for file in $(find . -name "*ssp*.json" 2>/dev/null); do
          if [ -f "$file" ]; then
            echo "Validating: $file"
            oscal-cli ssp validate "$file"
          fi
        done
      continue-on-error: true
    
    - name: Validate Assessment Plans
      run: |
        for file in $(find . -name "*assessment-plan*.json" 2>/dev/null); do
          if [ -f "$file" ]; then
            echo "Validating: $file"
            oscal-cli ap validate "$file"
          fi
        done
    
    - name: Validate Assessment Results
      run: |
        for file in $(find . -name "*assessment-results*.json" 2>/dev/null); do
          if [ -f "$file" ]; then
            echo "Validating: $file"
            oscal-cli ar validate "$file"
          fi
        done
      continue-on-error: true
    
    - name: Validate POAMs
      run: |
        for file in $(find . -name "*poam*.json" 2>/dev/null); do
          if [ -f "$file" ]; then
            echo "Validating: $file"
            oscal-cli poam validate "$file"
          fi
        done
      continue-on-error: true
