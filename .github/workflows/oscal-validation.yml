name: Validate OSCAL Content

on:
  push:
    branches: [ main ]
    paths:
      - '**/*catalog*.json'
      - '**/*profile*.json'
      - '**/*ssp*.json'

jobs:
  validate-content:
    runs-on: ubuntu-latest
    
    steps:
    - name: Manual clone (no submodules)
      run: |
        git clone --depth 1 --no-recurse-submodules https://github.com/${{ github.repository }}.git .
    
    - name: Set up Java
      uses: actions/setup-java@v4
      with:
        distribution: 'temurin'
        java-version: '17'
    
    - name: Setup OSCAL CLI
      uses: oscal-club/oscal-cli-action@v2.0.1
      with:
        args: --version
    
    - name: Validate OSCAL Catalogs
      run: |
        echo "Validating OSCAL catalog files..."
        for file in $(find . -name "*catalog*.json" 2>/dev/null); do
          if [ -f "$file" ]; then
            echo "Validating: $file"
            oscal-cli catalog validate "$file"
          fi
        done
    
    - name: Validate OSCAL Profiles
      run: |
        echo "Validating OSCAL profile files..."
        for file in $(find . -name "*profile*.json" 2>/dev/null); do
          if [ -f "$file" ]; then
            echo "Validating: $file"
            oscal-cli profile validate "$file"
          fi
        done