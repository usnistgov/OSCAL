name: OSCAL Validation

on:
  push:
    branches: [ main, add-171a-plan ]

jobs:
  validate-oscal:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4
      with:
        submodules: false
    
    - name: Setup Java
      uses: actions/setup-java@v4
      with:
        distribution: temurin
        java-version: '17'
    
    - name: Setup OSCAL CLI
      uses: oscal-club/oscal-cli-action@v2.0.1
      with:
        args: --version
    
    - name: Find Assessment Plans
      run: |
        echo "Searching for assessment plans..."
        find . -name "*assessment-plan*.json"
    
    - name: Validate Assessment Plans
      run: |
        echo "Validating assessment plans..."
        for file in $(find . -name "*assessment-plan*.json" 2>/dev/null); do
          if [ -f "$file" ]; then
            echo "Validating: $file"
            oscal-cli assessment-plan validate "$file"
          fi
        done