name: OSCAL Validation

on:
  workflow_dispatch:
  push:
    branches: [ main, develop, add-171a-plan ]
    paths:
      - '**/*.json'
      - '**/*.xml'
      - '**/*.yaml'
  pull_request:
    branches: [ main, develop ]
    paths:
      - '**/*.json'
      - '**/*.xml'
      - '**/*.yaml'

jobs:
  validate-oscal:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout (no submodules)
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          submodules: "false"
          lfs: "false"
          persist-credentials: "false"

      - name: Setup Java
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: "17"

      - name: Install oscal-cli
        run: |
          set -e
          VER="2.5.1"
          # download prebuilt release from Maven Central (Linux x86_64 tarball)
          curl -fsSL -o oscal-cli.tgz https://repo1.maven.org/maven2/dev/metaschema/oscal/oscal-cli-enhanced/${VER}/oscal-cli-enhanced-${VER}-linux-x86_64.tar.gz
          mkdir oscal-cli && tar -xzf oscal-cli.tgz -C oscal-cli --strip-components=1
          echo "$PWD/oscal-cli/bin" >> "$GITHUB_PATH"
      - name: Check version
        run: oscal-cli --version

      # Example validations (adjust to your files/commands)
      - name: Validate component definitions
        run: |
          find . -name "*component*.json" -print0 \
          | xargs -0 -I{} sh -c 'echo "::group::Validating {}"; oscal-cli component-definition validate "{}"; echo "::endgroup::"'
